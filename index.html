<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classifica√ß√£o SESAP - Com Banco de Dados</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Existing palette remains -->
    <!-- Application Structure Plan: The existing tabbed interface remains for regional classification. The core change is the underlying data persistence moving from client-side localStorage to a server-side NoSQL database (Firestore) managed by Firebase. This enhances data integrity, scalability, and security. The administration panel is updated to reflect this backend change, allowing database operations (backup/restore/clear) against the cloud database. User ID is displayed for context. -->
    <!-- Visualization & Content Choices: The core functionality of candidate classification and display (forms, lists, counters) remains. The administrative tools are re-engineered to interface with Firestore. Notification system and custom confirmation modal are retained/added for user feedback and interaction. No new complex visualizations are introduced as the primary focus is on robust backend data management. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8F7F4; color: #333333; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { background-color: #3B82F6; color: white; }
        .admin-panel { display: none; }
        .admin-panel.active { display: block; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 50; }
        .modal-content-custom { background-color: white; padding: 2rem; border-radius: 0.5rem; max-width: 400px; width: 90%; text-align: center; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-4">
        <div class="bg-white rounded-lg shadow-lg">
            <!-- Header -->
            <div class="bg-blue-600 text-white p-6 rounded-t-lg">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold flex items-center">
                            <i class="fas fa-hospital mr-3"></i>
                            Classifica√ß√£o SESAP
                        </h1>
                        <p class="text-blue-100 mt-2">Sistema de Classifica√ß√£o por Regi√µes com Banco de Dados</p>
                        <p id="userStatus" class="text-blue-100 mt-1 text-sm"></p> <!-- User ID display -->
                    </div>
                    <button id="adminToggle" class="bg-blue-800 hover:bg-blue-900 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-cog mr-2"></i>Administra√ß√£o
                    </button>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanel" class="admin-panel bg-gray-50 p-6 border-b">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">
                    <i class="fas fa-database mr-2"></i>Gerenciamento de Banco de Dados
                </h3>
                <div class="grid md:grid-cols-4 gap-4">
                    <button id="backupBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition">
                        <i class="fas fa-download mr-2"></i>Backup JSON
                    </button>
                    <button id="restoreBtn" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition">
                        <i class="fas fa-upload mr-2"></i>Restaurar
                    </button>
                    <button id="exportCsvBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition">
                        <i class="fas fa-file-csv mr-2"></i>Exportar CSV
                    </button>
                    <button id="clearAllBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition">
                        <i class="fas fa-trash mr-2"></i>Limpar Tudo
                    </button>
                </div>
                <input type="file" id="restoreFile" accept=".json" class="hidden">
                
                <!-- Database Status -->
                <div class="mt-4 p-4 bg-white rounded-lg border">
                    <h4 class="font-semibold text-gray-700 mb-2">Status do Banco de Dados:</h4>
                    <div id="dbStatus" class="text-sm text-gray-600"></div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex flex-wrap border-b bg-gray-50">
                <button class="tab-button active px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="1">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 1
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="2">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 2
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="3">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 3
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="4">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 4
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="5">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 5
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="6">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 6
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="7">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 7
                </button>
                <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-gray-200 transition" data-region="8">
                    <i class="fas fa-map-marker-alt mr-2"></i>Regi√£o 8
                </button>
            </div>

            <!-- Tab Contents -->
            <div class="p-6">
                <!-- Regi√£o 1-8 (Template) -->
                <div class="tab-content active" data-region="1">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <!-- Form Column -->
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 1
                            </h3>
                            <form class="candidate-form space-y-4" data-region="1">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>

                        <!-- Lists Column -->
                        <div class="space-y-6">
                            <!-- Ampla Concorr√™ncia -->
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 1
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-1">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="1" data-tipo="ampla"></div>
                            </div>

                            <!-- PCD -->
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 1
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-1">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="1" data-tipo="pcd"></div>
                            </div>

                            <!-- PPP -->
                            <div class="bg-white border rounded-lg">
                                <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 1
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-1">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="1" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Repeat for regions 2-8 -->
                <div class="tab-content" data-region="2">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 2
                            </h3>
                            <form class="candidate-form space-y-4" data-region="2">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 2
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-2">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="2" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 2
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-2">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="2" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 2
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-2">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="2" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Continue for regions 3-8 -->
                <div class="tab-content" data-region="3">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 3
                            </h3>
                            <form class="candidate-form space-y-4" data-region="3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 3
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-3">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="3" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 3
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-3">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="3" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 3
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-3">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="3" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-region="4">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 4
                            </h3>
                            <form class="candidate-form space-y-4" data-region="4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 4
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-4">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="4" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 4
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-4">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="4" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 4
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-4">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="4" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-region="5">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 5
                            </h3>
                            <form class="candidate-form space-y-4" data-region="5">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 5
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-5">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="5" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 5
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-5">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="5" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 5
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-5">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="5" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-region="6">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 6
                            </h3>
                            <form class="candidate-form space-y-4" data-region="6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 6
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-6">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="6" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 6
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-6">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="6" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 6
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-6">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="6" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-region="7">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 7
                            </h3>
                            <form class="candidate-form space-y-4" data-region="7">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 7
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-7">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="7" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 7
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-7">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="7" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 7
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-7">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="7" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-region="8">
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-user-plus mr-2 text-blue-600"></i>Cadastro de Candidato - Regi√£o 8
                            </h3>
                            <form class="candidate-form space-y-4" data-region="8">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome do Candidato
                                    </label>
                                    <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-star mr-2"></i>Pontua√ß√£o
                                    </label>
                                    <input type="number" name="pontuacao" required step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list mr-2"></i>Tipo de Vaga
                                    </label>
                                    <select name="tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo</option>
                                        <option value="ampla">üèÜ Ampla Concorr√™ncia</option>
                                        <option value="pcd">‚ôø PCD (Pessoa com Defici√™ncia)</option>
                                        <option value="ppp">üéØ PPP (Pessoa Preto ou Pardo)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-2"></i>Finalizar Cadastro
                                </button>
                            </form>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-white border rounded-lg">
                                <div class="bg-yellow-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üèÜ Ampla Concorr√™ncia - Regi√£o 8
                                        <span class="ml-auto bg-yellow-600 px-2 py-1 rounded text-sm" data-count="ampla-8">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="8" data-tipo="ampla"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-green-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        ‚ôø PCD - Regi√£o 8
                                        <span class="ml-auto bg-green-600 px-2 py-1 rounded text-sm" data-count="pcd-8">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="8" data-tipo="pcd"></div>
                            </div>
                            <div class="bg-white border rounded-lg">
                                <div class="bg-purple-500 text-white p-4 rounded-t-lg">
                                    <h4 class="font-semibold flex items-center">
                                        üéØ PPP - Regi√£o 8
                                        <span class="ml-auto bg-purple-600 px-2 py-1 rounded text-sm" data-count="ppp-8">0</span>
                                    </h4>
                                </div>
                                <div class="lista-candidatos max-h-64 overflow-y-auto" data-region="8" data-tipo="ppp"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Confirmation Modal HTML -->
    <div id="confirmationModal" class="modal-overlay hidden">
        <div class="modal-content-custom">
            <p id="confirmationMessage" class="text-lg font-semibold mb-4"></p>
            <div class="flex justify-around space-x-4">
                <button id="confirmYes" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg flex-1">Sim</button>
                <button id="confirmNo" class="bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4 rounded-lg flex-1">N√£o</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Importar os m√≥dulos Firebase necess√°rios
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, onSnapshot, query, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // A classe FirebaseSESAPDatabase gerencia toda a intera√ß√£o com o Firebase Firestore.
        // Ela encapsula a l√≥gica de inicializa√ß√£o, autentica√ß√£o, adi√ß√£o, recupera√ß√£o,
        // exclus√£o e restaura√ß√£o de dados, al√©m de manter um array local sincronizado
        // com o banco de dados em tempo real atrav√©s de onSnapshot.
        class FirebaseSESAPDatabase {
            constructor() {
                this.app = null;       // Inst√¢ncia do Firebase App
                this.auth = null;      // Inst√¢ncia do Firebase Auth
                this.db = null;        // Inst√¢ncia do Firebase Firestore
                this.userId = null;    // ID do usu√°rio autenticado (anonimamente ou com token)
                // ID do aplicativo, obtido de uma vari√°vel global fornecida pelo ambiente (Canvas)
                this.appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                // Array local para armazenar uma c√≥pia dos candidatos. Sincronizado pelo listener do Firestore.
                this.allCandidates = [];
                // Flag para indicar se a autentica√ß√£o e a conex√£o com o Firestore est√£o prontas
                this.isAuthReady = false;
                
                // Inicia o processo de inicializa√ß√£o ass√≠ncrona do Firebase quando a classe √© instanciada
                this.initializeFirebase();
            }

            // M√©todo ass√≠ncrono para inicializar o Firebase.
            // Conecta-se ao Firebase, autentica o usu√°rio e configura o listener de dados.
            async initializeFirebase() {
                try {
                    // Analisa a configura√ß√£o do Firebase, que √© esperada como uma string JSON global
                    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                    
                    // Inicializa o aplicativo Firebase
                    this.app = initializeApp(firebaseConfig);
                    // Obt√©m as inst√¢ncias dos servi√ßos de autentica√ß√£o e Firestore
                    this.auth = getAuth(this.app);
                    this.db = getFirestore(this.app);

                    // Tenta autenticar o usu√°rio. Prioriza o token personalizado (__initial_auth_token)
                    // para sess√µes autenticadas, caso contr√°rio, autentica anonimamente.
                    if (typeof __initial_auth_token !== 'undefined') {
                        await signInWithCustomToken(this.auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(this.auth);
                    }
                    
                    // Define o ID do usu√°rio (UID do Firebase ou um UUID gerado aleatoriamente para usu√°rios an√¥nimos)
                    this.userId = this.auth.currentUser?.uid || crypto.randomUUID();
                    // Marca a autentica√ß√£o como pronta
                    this.isAuthReady = true;
                    console.log("Firebase inicializado. ID do Usu√°rio:", this.userId);
                    
                    // Uma vez que o Firebase est√° pronto e o usu√°rio autenticado, configura o listener de dados
                    this._setupCandidatesListener();
                    
                } catch (error) {
                    // Em caso de erro na inicializa√ß√£o, registra no console
                    console.error("Erro ao inicializar Firebase:", error);
                    // Aqui voc√™ poderia adicionar uma notifica√ß√£o visual ao usu√°rio
                }
            }

            // Configura o listener em tempo real (onSnapshot) para a cole√ß√£o de candidatos.
            // Garante que o array local 'allCandidates' esteja sempre sincronizado com o Firestore.
            _setupCandidatesListener() {
                // Verifica se a autentica√ß√£o est√° pronta antes de configurar o listener
                if (!this.isAuthReady) {
                    console.warn("Firestore n√£o est√° pronto para configurar listener. Aguardando autentica√ß√£o.");
                    return;
                }
                // Define a refer√™ncia da cole√ß√£o de candidatos. O caminho inclui o appId e o userId
                // para isolar os dados por aplicativo e por usu√°rio.
                const candidatesCollectionRef = collection(this.db, `artifacts/${this.appId}/users/${this.userId}/candidates`);
                
                // onSnapshot: Observa a cole√ß√£o em tempo real.
                // O callback √© executado inicialmente e sempre que houver uma mudan√ßa nos documentos da cole√ß√£o.
                onSnapshot(candidatesCollectionRef, (snapshot) => {
                    this.allCandidates = []; // Limpa o array local para recarregar os dados
                    snapshot.forEach((doc) => {
                        // Para cada documento no snapshot, adiciona seus dados e ID ao array local
                        this.allCandidates.push({ id: doc.id, ...doc.data() });
                    });
                    console.log("Dados do Firestore atualizados localmente:", this.allCandidates);
                    // Dispara um evento personalizado para notificar a UI de que os dados foram atualizados
                    this._dispatchDataUpdateEvent();
                }, (error) => {
                    // Em caso de erro no listener, registra no console
                    console.error("Erro ao receber atualiza√ß√µes do Firestore:", error);
                    // Aqui voc√™ poderia adicionar uma notifica√ß√£o visual de erro
                });
            }

            // Dispara um evento CustomEvent 'firebaseDataUpdated' no objeto document.
            // Isso permite que outros scripts na p√°gina (a UI) reajam √†s atualiza√ß√µes de dados do Firebase.
            _dispatchDataUpdateEvent() {
                const event = new CustomEvent('firebaseDataUpdated');
                document.dispatchEvent(event);
            }

            // Adiciona um novo candidato ao Firestore.
            async addCandidate(region, candidate) {
                // Verifica se o Firebase est√° pronto para opera√ß√µes de escrita
                if (!this.isAuthReady) {
                    console.error("Firestore n√£o est√° pronto. Candidato n√£o adicionado.");
                    return false;
                }
                try {
                    const candidatesCollectionRef = collection(this.db, `artifacts/${this.appId}/users/${this.userId}/candidates`);
                    await addDoc(candidatesCollectionRef, {
                        ...candidate, // Espalha as propriedades do objeto candidato (nome, pontuacao, tipo)
                        region: region, // Adiciona a regi√£o do candidato
                        timestamp: new Date().toISOString() // Adiciona um timestamp de cria√ß√£o
                    });
                    console.log(`Candidato adicionado no Firestore:`, candidate);
                    return true;
                } catch (e) {
                    console.error("Erro ao adicionar candidato ao Firestore: ", e);
                    return false;
                }
            }

            // Retorna os candidatos filtrados por regi√£o e tipo de vaga do array local 'allCandidates'.
            // Os dados s√£o pr√©-ordenados por pontua√ß√£o.
            getRegionData(region) {
                // Filtra todos os candidatos para a regi√£o especificada
                const candidatesForRegion = this.allCandidates.filter(c => c.region == region);
                const regionData = { ampla: [], pcd: [], ppp: [] };

                // Para cada tipo de vaga, filtra e ordena os candidatos da regi√£o
                ['ampla', 'pcd', 'ppp'].forEach(tipo => {
                    regionData[tipo] = candidatesForRegion
                                        .filter(c => c.tipo === tipo)
                                        .sort((a, b) => b.pontuacao - a.pontuacao);
                });
                return regionData;
            }

            // Retorna uma c√≥pia de todos os candidatos atualmente no array local 'allCandidates'.
            getAllData() {
                return JSON.parse(JSON.stringify(this.allCandidates)); // Retorna uma c√≥pia profunda
            }

            // Exclui todos os documentos de candidatos do Firestore para o usu√°rio atual.
            async clearAll() {
                if (!this.isAuthReady) {
                    console.error("Firestore n√£o est√° pronto. N√£o √© poss√≠vel limpar os dados.");
                    return false;
                }
                try {
                    const candidatesCollectionRef = collection(this.db, `artifacts/${this.appId}/users/${this.userId}/candidates`);
                    const q = query(candidatesCollectionRef);
                    const querySnapshot = await getDocs(q); // Obt√©m todos os documentos

                    const deletePromises = [];
                    querySnapshot.forEach((doc) => {
                        deletePromises.push(deleteDoc(doc.ref)); // Adiciona uma promessa de exclus√£o para cada documento
                    });
                    await Promise.all(deletePromises); // Espera todas as exclus√µes serem conclu√≠das
                    console.log("Todos os dados foram limpos no Firestore.");
                    return true;
                } catch (e) {
                    console.error("Erro ao limpar dados do Firestore: ", e);
                    return false;
                }
            }

            // Restaura dados a partir de um JSON. Limpa os dados existentes e adiciona os novos.
            async restoreData(jsonData) {
                if (!this.isAuthReady) {
                    console.error("Firestore n√£o est√° pronto. N√£o √© poss√≠vel restaurar os dados.");
                    return false;
                }
                try {
                    const dataToRestore = JSON.parse(jsonData);
                    
                    if (!dataToRestore || !Array.isArray(dataToRestore)) {
                        console.error('Formato de arquivo inv√°lido. Esperado um array de candidatos.');
                        return false;
                    }

                    // Limpa todos os dados existentes antes de iniciar a restaura√ß√£o
                    await this.clearAll();

                    const candidatesCollectionRef = collection(this.db, `artifacts/${this.appId}/users/${this.userId}/candidates`);
                    const addPromises = [];
                    
                    // Itera sobre os dados a serem restaurados e adiciona cada candidato ao Firestore
                    for (const candidate of dataToRestore) {
                        // Valida√ß√£o b√°sica dos campos obrigat√≥rios do candidato
                        if (candidate.nome && candidate.pontuacao !== undefined && candidate.tipo && candidate.region) {
                            addPromises.push(addDoc(candidatesCollectionRef, {
                                nome: candidate.nome,
                                pontuacao: parseFloat(candidate.pontuacao),
                                tipo: candidate.tipo,
                                region: candidate.region,
                                timestamp: candidate.timestamp || new Date().toISOString() // Usa timestamp existente ou cria um novo
                            }));
                        } else {
                            console.warn("Candidato inv√°lido no arquivo de restaura√ß√£o, pulando:", candidate);
                        }
                    }
                    await Promise.all(addPromises); // Espera todas as adi√ß√µes serem conclu√≠das
                    console.log('Dados restaurados com sucesso no Firestore!');
                    return true;
                } catch (e) {
                    console.error("Erro ao restaurar dados no Firestore: ", e);
                    return false;
                }
            }

            // Exporta todos os candidatos locais para uma string JSON formatada.
            exportJSON() {
                return JSON.stringify(this.allCandidates, null, 2);
            }

            // Exporta todos os candidatos locais para uma string CSV.
            exportCSV() {
                let csv = 'Regi√£o,Nome,Pontua√ß√£o,Tipo,Data/Hora\n';
                this.allCandidates.forEach(candidato => {
                    const tipoName = candidato.tipo === 'ampla' ? 'Ampla Concorr√™ncia' : 
                                   candidato.tipo === 'pcd' ? 'PCD' : 'PPP';
                    csv += `${candidato.region},"${candidato.nome}",${candidato.pontuacao},${tipoName},${candidato.timestamp}\n`;
                });
                return csv;
            }
        }

        // Instancia o banco de dados Firebase
        const db = new FirebaseSESAPDatabase();

        // Vari√°vel global para armazenar a regi√£o atualmente ativa na interface.
        // √â usada para recarregar a vis√£o correta ap√≥s atualiza√ß√µes de dados.
        let currentActiveRegion = '1';

        /**
         * Atualiza o display de status do banco de dados na interface.
         * Mostra o total de candidatos e o ID do usu√°rio atualmente autenticado.
         */
        function updateDbStatusDisplay() {
            const statusDiv = document.getElementById('dbStatus');
            const userStatusDiv = document.getElementById('userStatus');

            // Verifica se a inst√¢ncia do Firebase e a autentica√ß√£o est√£o prontas
            if (db.isAuthReady) {
                const totalCandidatos = db.allCandidates.length;
                statusDiv.innerHTML = `
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><strong>Total de candidatos:</strong> ${totalCandidatos}</div>
                        <div><strong>√öltima atualiza√ß√£o (Firestore):</strong> ${new Date().toLocaleString('pt-BR')}</div>
                    </div>
                `;
                // Exibe o ID completo do usu√°rio para fins de depura√ß√£o e colabora√ß√£o
                userStatusDiv.textContent = `ID do Usu√°rio: ${db.userId}`;
            } else {
                // Mensagem de status enquanto o Firebase est√° inicializando
                statusDiv.innerHTML = '<div class="text-gray-600">Aguardando conex√£o com o banco de dados.</div>';
                userStatusDiv.textContent = 'Autenticando...';
            }
        }

        /**
         * Carrega e exibe os dados dos candidatos para a regi√£o especificada.
         * Esta fun√ß√£o √© chamada quando a aba de uma regi√£o √© ativada ou quando os dados s√£o atualizados.
         * @param {string} region - O n√∫mero da regi√£o (ex: '1', '2') cujos dados ser√£o exibidos.
         */
        function loadRegionData(region) {
            // Obt√©m os dados dos candidatos para a regi√£o e os tipos de vaga espec√≠ficos
            const regionData = db.getRegionData(region);

            // Itera sobre cada tipo de vaga para atualizar as listas e contadores correspondentes
            ['ampla', 'pcd', 'ppp'].forEach(tipo => {
                // Seleciona o cont√™iner da lista de candidatos e o elemento contador
                const lista = document.querySelector(`.lista-candidatos[data-region="${region}"][data-tipo="${tipo}"]`);
                const counter = document.querySelector(`[data-count="${tipo}-${region}"]`);
                
                if (lista && counter) {
                    lista.innerHTML = ''; // Limpa o conte√∫do atual da lista
                    counter.textContent = regionData[tipo].length; // Atualiza o contador de candidatos

                    if (regionData[tipo].length === 0) {
                        // Exibe uma mensagem se n√£o houver candidatos para esta categoria na regi√£o
                        lista.innerHTML = '<div class="p-4 text-gray-500 text-center">Nenhum candidato cadastrado</div>';
                    } else {
                        // Popula a lista com os dados dos candidatos
                        regionData[tipo].forEach((candidato, index) => {
                            const item = document.createElement('div');
                            item.className = 'flex justify-between items-center p-3 border-b border-gray-200 hover:bg-gray-50';
                            item.innerHTML = `
                                <div class="flex items-center space-x-3">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-medium">${index + 1}¬∫</span>
                                    <div>
                                        <div class="font-medium text-gray-900">${candidato.nome}</div>
                                        <div class="text-sm text-gray-500">Cadastrado em: ${new Date(candidato.timestamp).toLocaleString('pt-BR')}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-gray-900">${candidato.pontuacao.toFixed(2)}</div>
                                    <div class="text-xs text-gray-500">pontos</div>
                                </div>
                            `;
                            lista.appendChild(item);
                        });
                    }
                }
            });
        }

        /**
         * Exibe um modal de confirma√ß√£o personalizado, substituindo o `window.confirm`.
         * @param {string} message - A mensagem a ser exibida no modal.
         * @param {Function} callback - A fun√ß√£o a ser chamada com `true` (Sim) ou `false` (N√£o).
         */
        function showConfirmationModal(message, callback) {
            const confirmationModal = document.getElementById('confirmationModal');
            const confirmationMessage = document.getElementById('confirmationMessage');
            const confirmYes = document.getElementById('confirmYes');
            const confirmNo = document.getElementById('confirmNo');

            confirmationMessage.textContent = message;
            confirmationModal.classList.remove('hidden'); // Mostra o modal

            // Fun√ß√µes para lidar com os cliques nos bot√µes Sim/N√£o
            const handleYes = () => {
                callback(true);
                confirmationModal.classList.add('hidden'); // Esconde o modal
                // Remove os listeners para evitar chamadas duplicadas
                confirmYes.removeEventListener('click', handleYes);
                confirmNo.removeEventListener('click', handleNo);
            };

            const handleNo = () => {
                callback(false);
                confirmationModal.classList.add('hidden'); // Esconde o modal
                // Remove os listeners para evitar chamadas duplicadas
                confirmYes.removeEventListener('click', handleYes);
                confirmNo.removeEventListener('click', handleNo);
            };

            // Adiciona os listeners aos bot√µes
            confirmYes.addEventListener('click', handleYes);
            confirmNo.addEventListener('click', handleNo);
        }

        /**
         * Exibe uma notifica√ß√£o tempor√°ria no canto superior direito da tela.
         * @param {string} message - A mensagem da notifica√ß√£o.
         * @param {string} type - O tipo de notifica√ß√£o ('success', 'error', 'info'), que afeta a cor.
         */
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'} mr-2"></i>
                    ${message}
                </div>
            `;
            document.body.appendChild(notification);
            
            // Remove a notifica√ß√£o ap√≥s 3 segundos
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // --- Event Listeners e L√≥gica Principal ---

        document.addEventListener('DOMContentLoaded', () => {
            // Listener para o evento 'firebaseDataUpdated' disparado pela classe FirebaseSESAPDatabase.
            // Isso garante que a UI seja atualizada sempre que os dados no Firestore mudarem.
            document.addEventListener('firebaseDataUpdated', () => {
                loadRegionData(currentActiveRegion); // Recarrega os dados da regi√£o ativa
                updateDbStatusDisplay();             // Atualiza o status do BD
            });

            // Event listeners para os bot√µes das abas de regi√£o
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const region = this.dataset.region;
                    currentActiveRegion = region; // Atualiza a regi√£o ativa globalmente
                    
                    // Remove a classe 'active' de todas as abas e conte√∫dos
                    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Adiciona a classe 'active' √† aba e conte√∫do clicados
                    this.classList.add('active');
                    document.querySelector(`.tab-content[data-region="${region}"]`).classList.add('active');
                    
                    loadRegionData(region); // Carrega e exibe os dados para a nova regi√£o ativa
                });
            });

            // Event listeners para os formul√°rios de cadastro de candidato
            document.querySelectorAll('.candidate-form').forEach(form => {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const region = this.dataset.region;
                    const formData = new FormData(this);
                    
                    const candidato = {
                        nome: formData.get('nome'),
                        pontuacao: parseFloat(formData.get('pontuacao')),
                        tipo: formData.get('tipo')
                    };
                    
                    // Chama o m√©todo da classe do BD para adicionar o candidato ao Firestore
                    const success = await db.addCandidate(region, candidato);
                    if (success) {
                        this.reset(); // Limpa o formul√°rio ap√≥s o sucesso
                        showNotification('Candidato adicionado com sucesso!', 'success');
                    } else {
                        showNotification('Erro ao adicionar candidato.', 'error');
                    }
                });
            });

            // Event listener para o bot√£o de alternar o painel administrativo
            document.getElementById('adminToggle').addEventListener('click', function() {
                const panel = document.getElementById('adminPanel');
                panel.classList.toggle('active');
                this.innerHTML = panel.classList.contains('active') ? 
                    '<i class="fas fa-times mr-2"></i>Fechar Admin' : 
                    '<i class="fas fa-cog mr-2"></i>Administra√ß√£o';
            });

            // Event listener para o bot√£o de Backup JSON
            document.getElementById('backupBtn').addEventListener('click', function() {
                const dataStr = db.exportJSON(); // Exporta os dados como JSON
                const dataBlob = new Blob([dataStr], {type:'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `sesap_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                showNotification('Backup criado com sucesso!', 'success');
            });

            // Event listener para o bot√£o de Restaurar
            document.getElementById('restoreBtn').addEventListener('click', function() {
                document.getElementById('restoreFile').click();
            });

            // Event listener para a sele√ß√£o de arquivo de restaura√ß√£o
            document.getElementById('restoreFile').addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        const success = await db.restoreData(e.target.result); // Restaura os dados do arquivo
                        if (success) {
                            showNotification('Dados restaurados com sucesso!', 'success');
                            // O listener 'firebaseDataUpdated' j√° vai recarregar a UI
                        } else {
                            showNotification('Erro ao restaurar dados. Verifique o arquivo.', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            });

            // Event listener para o bot√£o de Exportar CSV
            document.getElementById('exportCsvBtn').addEventListener('click', function() {
                const csvData = db.exportCSV(); // Exporta os dados como CSV
                const csvBlob = new Blob([csvData], {type:'text/csv'});
                const url = URL.createObjectURL(csvBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `sesap_candidatos_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                showNotification('Relat√≥rio CSV exportado com sucesso!', 'success');
            });

            // Event listener para o bot√£o Limpar Tudo
            document.getElementById('clearAllBtn').addEventListener('click', function() {
                showConfirmationModal('ATEN√á√ÉO: Esta a√ß√£o ir√° apagar TODOS os dados de TODAS as regi√µes PERMANENTEMENTE. Deseja continuar?', async (result1) => {
                    if (result1) {
                        showConfirmationModal('Tem certeza absoluta? Todos os candidatos cadastrados ser√£o perdidos permanentemente.', async (result2) => {
                            if (result2) {
                                const success = await db.clearAll(); // Limpa todos os dados no Firestore
                                if (success) {
                                    showNotification('Todos os dados foram apagados.', 'success');
                                    // O listener 'firebaseDataUpdated' j√° vai recarregar a UI
                                } else {
                                    showNotification('Erro ao apagar dados.', 'error');
                                }
                            }
                        });
                    }
                });
            });

            // Simula um clique no primeiro bot√£o de aba ao carregar a p√°gina
            // para garantir que a regi√£o 1 seja exibida e seus dados carregados.
            document.querySelector('.tab-button[data-region="1"]').click();
        });
    </script>
</body>
</html>
